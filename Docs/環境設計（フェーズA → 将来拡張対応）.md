# 環境設計（フェーズA → 将来拡張対応）

本ドキュメントは、競馬予想AIプロジェクトにおける**環境設計の確定版**である。要件定義・仕様定義を前提とし、実装前に「どのような環境を作るか」を固定することを目的とする。

---

## 1. 環境設計の目的

* フェーズA（分析）を、実際に利用可能な形で実装できる環境を定義する
* フェーズB（買い目生成）以降を、**UIや構成の作り直しなしで拡張可能**とする
* 実装段階で環境に関する迷い・揺り戻しを発生させない

---

## 2. 実行形態の前提

* ローカル実行
* 非公開利用
* Docker を用いたコンテナ環境
* Git によるバージョン管理を前提とする

---

## 3. 全体構成

システムは以下の3層構成とする。

```
[ Web UI ]
    ↓↑（HTTP）
[ API / アプリケーション ]
    ↓↑（SQL）
[ Database ]
```

この構成をフェーズA以降も固定し、破壊的変更を行わない。

---

## 4. 各コンポーネントの役割

### 4.1 Database（RDB）

**役割**

* システムにおける正のデータソース
* 分析・検証・会話状態の永続化

**保持するデータの種類**

* レース情報、開催年・開催条件
* 出走馬およびレース結果
* 分析結果（フェーズA）
* 会話ログ・ユーザー操作履歴（フェーズAから保持）

**DB種別**

* MySQL

---

### 4.2 API / アプリケーション

**実装言語**

* Python

**役割**

* システムの中枢として、すべてのロジックを担う

**責務**

* DBから事実データを取得
* 分析仕様に基づく計算の実行
* 検証仕様に基づく整合性チェック
* 結果の構造化および返却
* 会話状態の管理

**設計方針**

* APIの入口は**チャットI/Fを唯一の窓口**とする
* フェーズA／Bの違いは内部ロジックの分岐で吸収する

---

### 4.3 Web UI

**役割**

* 人間との唯一の接点
* 表示および入力に専念し、業務ロジックは持たない

**UI方針**

* 最初からチャットUIを採用する
* 単一画面で完結する設計とする

**将来拡張を前提とした要素**

* チャット + 補助UI（ボタン・フォーム）

  * 今週の重賞レース一覧（ボタン）
  * 予算・券種・配分入力（フォーム）
* すべて同一のチャットコンテキスト内で処理する

**禁止事項**

* 画面遷移前提の設計
* フェーズごとにUIを作り直す設計

---

## 5. ユーザー体験（環境設計レベルでの定義）

### フェーズA

* ブラウザを開く
* チャットまたはレース選択ボタンで分析を指示
* 分析結果（スコア・根拠）を閲覧

### フェーズB（将来）

* 同一画面で予算・馬券種・配分を入力
* 買い目計算結果を受け取る

※ 画面構造はフェーズAから変更しない

---

## 6. 拡張性の担保

* Database

  * 年間カレンダー
  * 全重賞対応
  * 会話ログ拡張
* API

  * チャットI/F固定、内部ロジック追加のみ
* Web UI

  * ボタン・フォーム追加のみ

---

## 7. Git管理方針（環境設計に含む）

* プロジェクトは最初から Git 管理とする
* Docker／DB／API／UI／ドキュメントを同一リポジトリで管理
* docs ディレクトリを正式成果物の置き場とする
* フェーズAとして正しい状態を main ブランチに保つ

---

## 8. 今は扱わない事項

* docker-compose.yml の具体記述
* API エンドポイント詳細
* フロントエンド技術選定
* 認証・外部公開・運用設計

---

## 9. 環境設計の結論

* Docker 前提のローカル環境
* MySQL + Python API + Web UI の3層構成
* チャットUIを最初から採用
* 会話ログをDBに保存
* Git管理を前提とした開発
* フェーズAから将来拡張まで、構成の作り直しは行わない

本ドキュメントをもって、環境設計は確定とする。
